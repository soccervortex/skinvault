# API Keys Setup Guide (Twitch, YouTube, TikTok)

This document provides step‑by‑step, professional instructions to obtain and configure the API keys required for Twitch, YouTube, and TikTok integrations in SkinVaults.

---

## 1. Twitch API Token (OAuth 2.0)

### 1.1. Create a Twitch Application
1. Go to the [Twitch Developer Console](https://dev.twitch.tv/console).
2. Sign in with your Twitch account.
3. Click **Applications** → **Register Your Application**.
4. Fill the form:
   - **Name**: `SkinVaults Creator Dashboard` (or any descriptive name)
   - **OAuth Redirect URLs**: `https://yourdomain.com/api/auth/twitch/callback` (replace with your actual domain)
   - **Category**: `Chat Bot`
5. Click **Create**.

### 1.2. Generate an OAuth Token
1. After creation, note the **Client ID**.
2. Click **Manage** on your app → **New Secret** to generate a **Client Secret**.
3. **Important (how this project works):**
   - Users do **not** manually generate and paste a Twitch access token.
   - The project uses an in-app OAuth flow:
     - Start: `GET /api/auth/twitch?slug=<creatorSlug>`
     - Callback: `GET /api/auth/twitch/callback`
   - Tokens are stored server-side per creator (DB key: `creator_twitch_connection_<slug>`).
4. OAuth details:
   - Authorization URL:
     ```
     https://id.twitch.tv/oauth2/authorize
       ?response_type=code
       &client_id=YOUR_CLIENT_ID
       &redirect_uri=https://yourdomain.com/api/auth/twitch/callback
       &scope=user:read:email
       &state=AUTOGENERATED
     ```
   - Token exchange:
     - `POST https://id.twitch.tv/oauth2/token`

### 1.3. Store Keys in Environment
Add to your `.env.local` (or server secrets):
```bash
TWITCH_CLIENT_ID=your_client_id
TWITCH_CLIENT_SECRET=your_client_secret

# Required for signing Steam session cookies + Twitch OAuth state
SESSION_SECRET=your_random_long_secret
# (Alternative supported by code)
# NEXTAUTH_SECRET=your_random_long_secret
```

---

## 2. YouTube (Current Implementation)

**No YouTube API key is required right now.**

The current creator snapshot implementation uses:
- `https://www.youtube.com/channel/<channelId>/live` (HTML check)
- `https://www.youtube.com/feeds/videos.xml?channel_id=<channelId>` (RSS feed)

If you want to upgrade to YouTube Data API v3 later (quota-based, key required), keep reading the optional section below.

### 2.1. (Optional) YouTube API Key (Google Cloud)

### 2.1. Create a Google Cloud Project
1. Go to the [Google Cloud Console](https://console.cloud.google.com/).
2. Create a new project (e.g., `SkinVaults YouTube Integration`).

### 2.2. Enable YouTube Data API v3
1. In the project dashboard, go to **APIs & Services** → **Library**.
2. Search for **YouTube Data API v3** and click **Enable**.

### 2.3. Create an API Key
1. Go to **APIs & Services** → **Credentials**.
2. Click **Create Credentials** → **API key**.
3. Copy the key.
4. **Restrict the key** (recommended):
   - **Application restrictions**: HTTP referrers (your domain) or server IP.
   - **API restrictions**: Only allow **YouTube Data API v3**.

### 2.4. Store Key in Environment
```bash
YOUTUBE_API_KEY=your_youtube_api_key
```

---

## 3. TikTok Integration (Improved)

### 3.1. Current Approach (Status API)
You currently use an external TikTok status API (`http://faashuis.ddns.net:8421`). This works but is not official and may be unreliable.

### 3.2. Recommended: Official TikTok API (for Business/Creator Accounts)
> **Note**: TikTok’s official API requires a **TikTok for Business** or **Creator Marketplace** account and approval.

#### 3.2.1. Register a TikTok App
1. Go to the [TikTok Developer Portal](https://developers.tiktok.com/).
2. Sign in with your TikTok account.
3. Click **Create App** → **Business**.
4. Fill the app details and provide your website URL.
5. Submit for approval.

#### 3.2.2. Obtain Access Token
- After approval, you’ll receive a **Client Key** and **Client Secret**.
- Use OAuth 2.0 to get an **access token** with scopes:
  - `video.list` (to fetch recent videos)
  - `user.info` (basic user profile)

#### 3.2.3. Store Keys
```bash
TIKTOK_CLIENT_KEY=your_client_key
TIKTOK_CLIENT_SECRET=your_client_secret
TIKTOK_ACCESS_TOKEN=your_access_token   # Store and refresh as needed
```

### 3.3. Fallback (Current Method)
If you cannot obtain official API access, keep using the status API but improve resilience:
- Add caching (e.g., 15‑minute TTL) to avoid hammering the endpoint.
- Implement graceful fallback: if the status API is down, keep the last known video/live state.

---

## 4. Environment Variables Summary

Add the following to your `.env.local` (never commit to git):

```bash
# Twitch
TWITCH_CLIENT_ID=your_twitch_client_id
TWITCH_CLIENT_SECRET=your_twitch_client_secret

# Required for Steam session + Twitch OAuth
SESSION_SECRET=your_random_long_secret

# YouTube
# Not required for current RSS/HTML implementation
# YOUTUBE_API_KEY=your_youtube_api_key

# TikTok (Official)
TIKTOK_CLIENT_KEY=your_tiktok_client_key
TIKTOK_CLIENT_SECRET=your_tiktok_client_secret
TIKTOK_ACCESS_TOKEN=your_tiktok_access_token

# TikTok (Current fallback)
TIKTOK_STATUS_API_BASE_URL=http://faashuis.ddns.net:8421
```

---

## 5. Code Integration Tips

### 5.1. Centralize API Calls
Create a utility file (`src/app/lib/platform-api.ts`) to abstract:
- Twitch live status
- YouTube live/latest video
- TikTok status/latest video

### 5.2. Error Handling & Caching
- Use `try/catch` with timeouts for each API call.
- Cache results (e.g., in Redis or memory) with appropriate TTL:
  - Twitch: 2–5 minutes
  - YouTube: 10–15 minutes
  - TikTok: 15 minutes (or longer if using the fallback API)

### 5.3. Security
- Never expose API keys on the client side.
- Use server‑side routes (`/api/creator/[slug]`) to fetch data.
- Rotate keys periodically.

---

## 6. Testing

1. **Twitch**: Verify you can fetch live status for a known channel.
2. **YouTube**: Test the live check and latest video fetch via RSS.
3. **TikTok**: Ensure the status API returns a valid `latest_video` URL and live flag.

---

## 7. Troubleshooting

| Issue | Likely Cause | Fix |
|-------|--------------|-----|
| `401 Unauthorized` (Twitch) | Missing/expired OAuth token stored for that creator | Click **Connect Twitch** again on the creator page (re-authorize) |
| `Invalid state` (Twitch) | Missing `SESSION_SECRET` or cookies blocked | Set `SESSION_SECRET` and allow cookies; retry |
| `quotaExceeded` (YouTube Data API) | API key overused (only if you enabled API v3) | Restrict key, enable billing, or use RSS/HTML mode |
| TikTok “no video” | Status API down | Enable fallback to cached data |
| CORS errors | Client‑side API calls | Move calls to server‑side API routes |

---

## 8. Next Steps

1. Obtain the API keys as described.
2. Add the keys to your environment.
3. Update the creator snapshot API to use the official APIs where possible.
4. Add monitoring/logging for API failures.
5. Document any rate limits or quotas.

---

**Need help?**  
- Twitch docs: https://dev.twitch.tv/docs
- YouTube docs: https://developers.google.com/youtube/v3
- TikTok docs: https://developers.tiktok.com/doc

---
